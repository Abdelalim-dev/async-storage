"use strict";(self.webpackChunkasync_storage_website=self.webpackChunkasync_storage_website||[]).push([[810],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(n),m=r,g=u["".concat(s,".").concat(m)]||u[m]||d[m]||i;return n?a.createElement(g,o(o({ref:t},p),{},{components:n})):a.createElement(g,o({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var c=2;c<i;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},9210:function(e,t,n){var a=n(7294);t.Z=function(e){var t=e.platformIcon,n=e.title;return a.createElement("div",{style:{display:"flex",margin:"10px 20px",alignItems:"center",flexDirection:"row"}},a.createElement("img",{style:{width:34,height:34},src:"/async-storage/img/"+t}),a.createElement("p",{style:{margin:"0 0 0 10px",padding:0}},n))}},8798:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return p},toc:function(){return d},default:function(){return m}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),o=n(9210),l=["components"],s={id:"next",title:"Next storage implementation",sidebar_label:"Next storage implementation"},c=void 0,p={unversionedId:"advanced/next",id:"advanced/next",isDocsHomePage:!1,title:"Next storage implementation",description:"Supported platforms:",source:"@site/docs/advanced/Next.md",sourceDirName:"advanced",slug:"/advanced/next",permalink:"/async-storage/docs/advanced/next",editUrl:"https://github.com/react-native-async-storage/async-storage/edit/master/website/docs/advanced/Next.md",version:"current",frontMatter:{id:"next",title:"Next storage implementation",sidebar_label:"Next storage implementation"},sidebar:"docs",previous:{title:"API",permalink:"/async-storage/docs/api"},next:{title:"Jest integration",permalink:"/async-storage/docs/advanced/jest"}},d=[{value:"Motivation",id:"motivation",children:[]},{value:"Migration",id:"migration",children:[]},{value:"Enabling",id:"enabling",children:[]},{value:"Notable changes",id:"notable-changes",children:[]}],u={toc:d};function m(e){var t=e.components,n=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Supported platforms:")),(0,i.kt)(o.Z,{title:"Android",platformIcon:"icon_android.svg",mdxType:"PlatformSupport"}),(0,i.kt)("hr",null),(0,i.kt)("h3",{id:"motivation"},"Motivation"),(0,i.kt)("p",null,"Current implementation of persistence layer is created using ",(0,i.kt)("a",{parentName:"p",href:"https://developer.android.com/reference/android/database/sqlite/SQLiteOpenHelper"},"SQLiteOpenHelper"),",\na helper class that manages database creation and migrations. Even if this approach is powerful, the lack of compile time query verification and a big boilerplate of mapping SQLite queries  to actual values make this implementation prone to many errors."),(0,i.kt)("p",null,"This Async Storage feature improves the persistence layer, using modern approaches to access SQLite (using ",(0,i.kt)("a",{parentName:"p",href:"https://developer.android.com/training/data-storage/room"},"Room"),"), to reduce possible anomalies to the minimum.\nOn top of that, it allows to access Async Storage from the native side, useful in ",(0,i.kt)("a",{parentName:"p",href:"/async-storage/docs/advanced/brownfield#android"},"Brownfield integration.")),(0,i.kt)("h3",{id:"migration"},"Migration"),(0,i.kt)("p",null,"This feature requires no migration from the developer perspective - the current database will be recreated (based on the current one), meaning user won't lose any data if you decide to opt in.\nThere's a small drawback to know - the database \"recreation\" happens ",(0,i.kt)("strong",{parentName:"p"},"only once"),". Unless you want to disable the feature in the future, there's nothing to worry about."),(0,i.kt)("h4",{id:"how-it-works"},"How it works"),(0,i.kt)("p",null,"The new database (the one used by this feature) will be created based on the current database file, if the new one does not exist yet.\nIf we detect that there's already the new database on the device, recreation will not kick in."),(0,i.kt)("h4",{id:"why-is-it-important"},"Why is it important"),(0,i.kt)("p",null,"Let's say you enabled the feature for the first time - recreation kicks in and the old database file is untouched.\nIf you decide to disable the feature, your users will be back using old database. No data migrations is happening from new to old database file.\nWhen you enable the feature again, the new database is ",(0,i.kt)("strong",{parentName:"p"},"not")," recreated, because it already exists, and no data is copied over."),(0,i.kt)("h3",{id:"enabling"},"Enabling"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"In your project's ",(0,i.kt)("inlineCode",{parentName:"li"},"android")," directory, locate root ",(0,i.kt)("inlineCode",{parentName:"li"},"build.gradle")," file. Add Kotlin dependency to the ",(0,i.kt)("inlineCode",{parentName:"li"},"buildscript"),":")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-diff"},"buildscript {\n    ext {\n        // other extensions\n+        kotlinVersion = '1.4.21'\n    }\n    \n    dependencies {\n        // other dependencies\n+        classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlinVersion\"\n    }\n}\n\n")),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},"In the same directory (normally ",(0,i.kt)("inlineCode",{parentName:"li"},"android"),") locate ",(0,i.kt)("inlineCode",{parentName:"li"},"gradle.properties")," file (if does not exists, create one) and add the line:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-groovy"},"AsyncStorage_useNextStorage=true\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"How to specifying Kotlin version")),(0,i.kt)("p",null,"Supported Kotlin versions are ",(0,i.kt)("inlineCode",{parentName:"p"},"1.4.x"),". You can specify which one to use in two ways:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"having an ",(0,i.kt)("inlineCode",{parentName:"li"},"kotlinVersion")," extension on the ",(0,i.kt)("inlineCode",{parentName:"li"},"rootProject")," (recommended):")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-groovy"},"rootProject.ext.kotlinVersion = '1.4.21'\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"specify ",(0,i.kt)("inlineCode",{parentName:"li"},"AsyncStorage_kotlinVersion")," in ",(0,i.kt)("inlineCode",{parentName:"li"},"gradle.properties"),":")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-groovy"},"AsyncStorage_kotlinVersion=1.4.21\n")),(0,i.kt)("h3",{id:"notable-changes"},"Notable changes"),(0,i.kt)("p",null,"Alongside of a warning regarding ",(0,i.kt)("inlineCode",{parentName:"p"},"key"),"/",(0,i.kt)("inlineCode",{parentName:"p"},"value"),", errors are thrown when:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Your ",(0,i.kt)("inlineCode",{parentName:"li"},"key")," is ",(0,i.kt)("inlineCode",{parentName:"li"},"null")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"not a string")),(0,i.kt)("li",{parentName:"ul"},"You provide value that is ",(0,i.kt)("inlineCode",{parentName:"li"},"not a string"))))}m.isMDXComponent=!0}}]);