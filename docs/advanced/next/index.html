<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.54">


<title data-react-helmet="true">Next storage implementation | Async Storage</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Next storage implementation | Async Storage"><meta data-react-helmet="true" name="description" content="import PlatformSupport from &quot;../../src/components/Platform.js&quot;"><meta data-react-helmet="true" property="og:description" content="import PlatformSupport from &quot;../../src/components/Platform.js&quot;"><meta data-react-helmet="true" property="og:url" content="https://react-native-async-storage.github.io/async-storage//async-storage/docs/advanced/next">

<link data-react-helmet="true" rel="shortcut icon" href="/async-storage/img/favicon.ico">


<link rel="stylesheet" href="/async-storage/styles.19b9f91f.css">


<link rel="preload" href="/async-storage/styles.fac3ee2c.js" as="script">

<link rel="preload" href="/async-storage/runtime~main.05be5646.js" as="script">

<link rel="preload" href="/async-storage/main.2474c7fb.js" as="script">

<link rel="preload" href="/async-storage/1.3f0af198.js" as="script">

<link rel="preload" href="/async-storage/2.01667555.js" as="script">

<link rel="preload" href="/async-storage/19.924143d3.js" as="script">

<link rel="preload" href="/async-storage/0346a40a.7a70be8f.js" as="script">

<link rel="preload" href="/async-storage/17896441.4c739a5f.js" as="script">

<link rel="preload" href="/async-storage/1f5177d4.31f43d9c.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/async-storage/"><img class="navbar__logo" src="/async-storage/img/logo.svg" alt="Async Storage Logo"><strong class="navbar__title">Async Storage</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/async-storage/docs/install">Docs</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/react-native-async-storage/async-storage" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/async-storage/"><img class="navbar__logo" src="/async-storage/img/logo.svg" alt="Async Storage Logo"><strong class="navbar__title">Async Storage</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" position="right" href="/async-storage/docs/install">Docs</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://github.com/react-native-async-storage/async-storage" class="menu__link" position="right">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/async-storage/docs/install">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/async-storage/docs/usage">Usage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/async-storage/docs/link">Manual linking</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/async-storage/docs/api">API</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Advanced</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" tabindex="0" href="/async-storage/docs/advanced/next">Next storage implementation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/async-storage/docs/advanced/jest">Jest integration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/async-storage/docs/advanced/brownfield">Brownfield integration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/async-storage/docs/advanced/backup">iCloud backup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/async-storage/docs/advanced/executor">Dedicated Executor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/async-storage/docs/advanced/db_size">Storage space increase</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Help</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/async-storage/docs/help/troubleshooting">Troubleshooting</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Next storage implementation</h1></header><div class="markdown"><p><strong>Supported platforms:</strong></p><div style="display:flex;margin:10px 20px;align-items:center;flex-direction:row"><img style="width:34px;height:34px" src="/async-storage/img/icon_android.svg"><p style="margin:0 0 0 10px;padding:0">Android</p></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="motivation"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#motivation" title="Direct link to heading">#</a>Motivation</h3><p>Current implementation of persistence layer is created using <a href="https://developer.android.com/reference/android/database/sqlite/SQLiteOpenHelper">SQLiteOpenHelper</a>,
a helper class that manages database creation and migrations. Even if this approach is powerful, the lack of compile time query verification and a big boilerplate of mapping SQLite queries  to actual values make this implementation prone to many errors.</p><p>This Async Storage feature improves the persistence layer, using modern approaches to access SQLite (using <a href="https://developer.android.com/training/data-storage/room">Room</a>), to reduce possible anomalies to the minimum.
On top of that, it allows to access Async Storage from the native side, useful in <a href="/async-storage/docs/advanced/brownfield#android">Brownfield integration.</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="migration"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#migration" title="Direct link to heading">#</a>Migration</h3><p>This feature requires no migration from the developer perspective - the current database will be recreated (based on the current one), meaning user won&#x27;t lose any data if you decide to opt in.
There&#x27;s a small drawback to know - the database &quot;recreation&quot; happens <strong>only once</strong>. Unless you want to disable the feature in the future, there&#x27;s nothing to worry about.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="how-it-works"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#how-it-works" title="Direct link to heading">#</a>How it works</h4><p>The new database (the one used by this feature) will be created based on the current database file, if the new one does not exist yet.
If we detect that there&#x27;s already the new database on the device, recreation will not kick in.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="why-is-it-important"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#why-is-it-important" title="Direct link to heading">#</a>Why is it important</h4><p>Let&#x27;s say you enabled the feature for the first time - recreation kicks in and the old database file is untouched.
If you decide to disable the feature, your users will be back using old database. No data migrations is happening from new to old database file.
When you enable the feature again, the new database is <strong>not</strong> recreated, because it already exists, and no data is copied over.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="enabling"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#enabling" title="Direct link to heading">#</a>Enabling</h3><ol><li>In your project&#x27;s <code>android</code> directory, locate root <code>build.gradle</code> file. Add Kotlin dependency to the <code>buildscript</code>:</li></ol><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-diff codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">buildscript {</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token unchanged">    ext {</span></div><div class="token-line" style="color:#9CDCFE"><span class="token unchanged">        // other extensions</span></div><div class="token-line" style="color:#9CDCFE"><span class="token unchanged"></span><span class="token inserted-sign inserted" style="color:rgb(181, 206, 168)">+        kotlinVersion = &#x27;1.4.21&#x27;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token inserted-sign inserted" style="color:rgb(181, 206, 168)"></span><span class="token unchanged">    }</span></div><div class="token-line" style="color:#9CDCFE"><span class="token unchanged">    </span></div><div class="token-line" style="color:#9CDCFE"><span class="token unchanged">    dependencies {</span></div><div class="token-line" style="color:#9CDCFE"><span class="token unchanged">        // other dependencies</span></div><div class="token-line" style="color:#9CDCFE"><span class="token unchanged"></span><span class="token inserted-sign inserted" style="color:rgb(181, 206, 168)">+        classpath &quot;org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlinVersion&quot;</span></div><div class="token-line" style="color:#9CDCFE"><span class="token inserted-sign inserted" style="color:rgb(181, 206, 168)"></span><span class="token unchanged">    }</span></div><div class="token-line" style="color:#9CDCFE"><span class="token unchanged"></span><span class="token plain">}</span></div><div class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><ol start="2"><li>In the same directory (normally <code>android</code>) locate <code>gradle.properties</code> file (if does not exists, create one) and add the line:</li></ol><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-groovy codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">AsyncStorage_useNextStorage=true</span></div></div></div></div></div><p><strong>How to specifying Kotlin version</strong></p><p>Supported Kotlin versions are <code>1.4.x</code>. You can specify which one to use in two ways:</p><ul><li>having an <code>kotlinVersion</code> extension on the <code>rootProject</code> (recommended):</li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-groovy codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">rootProject.ext.kotlinVersion = &#x27;1.4.21&#x27;</span></div></div></div></div></div><ul><li>specify <code>AsyncStorage_kotlinVersion</code> in <code>gradle.properties</code>:</li></ul><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-groovy codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#9CDCFE;background-color:#1E1E1E"><div class="token-line" style="color:#9CDCFE"><span class="token plain">AsyncStorage_kotlinVersion=1.4.21</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="notable-changes"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#notable-changes" title="Direct link to heading">#</a>Notable changes</h3><p>Alongside of a warning regarding <code>key</code>/<code>value</code>, errors are thrown when:</p><ul><li>Your <code>key</code> is <code>null</code> or <code>not a string</code></li><li>You provide value that is <code>not a string</code> </li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/react-native-async-storage/async-storage/edit/master/website/docs/advanced/Next.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/async-storage/docs/api"><div class="pagination-nav__link--sublabel">Previous</div><div class="pagination-nav__link--label">« API</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/async-storage/docs/advanced/jest"><div class="pagination-nav__link--sublabel">Next</div><div class="pagination-nav__link--label">Jest integration »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#motivation" class="contents__link">Motivation</a></li><li><a href="#migration" class="contents__link">Migration</a></li><li><a href="#enabling" class="contents__link">Enabling</a></li><li><a href="#notable-changes" class="contents__link">Notable changes</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Documentation</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/async-storage/docs/install">Installation</a></li><li class="footer__item"><a class="footer__link-item" href="/async-storage/docs/api">API reference</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://discord.gg/PycDts2">Discord</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://github.com/react-native-async-storage/async-storage">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2021 React Native Community. Built with Docusaurus.</div></div></div></footer>
</div>

<script src="/async-storage/styles.fac3ee2c.js"></script>

<script src="/async-storage/runtime~main.05be5646.js"></script>

<script src="/async-storage/main.2474c7fb.js"></script>

<script src="/async-storage/1.3f0af198.js"></script>

<script src="/async-storage/2.01667555.js"></script>

<script src="/async-storage/19.924143d3.js"></script>

<script src="/async-storage/0346a40a.7a70be8f.js"></script>

<script src="/async-storage/17896441.4c739a5f.js"></script>

<script src="/async-storage/1f5177d4.31f43d9c.js"></script>


</body>
</html>